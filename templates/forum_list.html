<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Community | SmartCampus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CDN (remove if you already include elsewhere) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tamuccBlue: '#003366',
            tamuccTeal: '#007A78',
            tamuccLight: '#00AEEF',
            tamuccGray: '#F4F7FA',
          }
        }
      }
    }
  </script>

  <style>
    /* optional: page-level tweaks */
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f4f7fa;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: #0067A5;
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: .75rem;
    }

    nav h1 {
      font-size: 1.6rem;
      font-weight: 600;
    }

    nav .logo {
      width: 52px;
      height: 45px;
      object-fit: contain;
      padding: 4px;
    }

    .nav-links a {
      color: #fff;
      text-decoration: none;
      margin-left: 1.5rem;
      font-weight: 500;
      transition: .3s;
    }

    .nav-links a:hover {
      color: #00A99D;
    }
  </style>
</head>

<body>

  <!-- header (was in partials/header.html earlier) -->
  <nav>
    <div class="nav-left">
      <img src="{{ url_for('static', path='assets/images/logo.png') }}" alt="SmartCampus Logo" class="logo">
      <h1>SmartCampus</h1>
    </div>

    <div class="nav-links">
      <a href="/">Home</a>

      {% if request.session.get('user') %}
      {% set u = request.session.get('user') %}

      {# role-aware dashboard link #}
      {% if u.role == 'student' %}
      <a href="/student_home">Dashboard</a>
      {% elif u.role == 'staff' %}
      <a href="/staff_home">Dashboard</a>
      {% elif u.role == 'admin' %}
      <a href="/admin_home">Dashboard</a>
      {% endif %}

      <a href="/forum">Community</a>
      <a href="/edit_profile">
        Profile
      </a>
      <a href="/logout">Logout</a>
      {% else %}
      <a href="/login">Portal</a>
      {% endif %}
    </div>
  </nav>

  <!-- main content -->
  <main class="flex-1">
    <div
      class="min-h-[calc(100vh-60px)] bg-gradient-to-br from-tamuccBlue via-tamuccTeal to-tamuccLight flex justify-center py-6 px-4">
      <div
        class="w-full max-w-6xl bg-white/80 backdrop-blur-md rounded-2xl shadow-2xl border border-white/30 flex flex-col">
        <!-- header inside card -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-white/40">
          <div>
            <h1 class="text-xl font-semibold text-tamuccBlue">Community forum</h1>
            <p class="text-xs text-gray-600">Ask doubts, share notices, help juniors.</p>
          </div>
          <div class="flex gap-3 items-center">
            <input id="forum-search" type="text" placeholder="Search discussions..."
              class="bg-white/70 border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-tamuccTeal/70">
            <a href="/forum/new"
              class="bg-tamuccTeal text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-tamuccLight transition">
              Start discussion
            </a>
          </div>
        </div>

        <!-- body grid -->
        <div class="grid grid-cols-12 gap-5 p-6">
          <!-- categories -->
          <aside class="col-span-12 md:col-span-3 bg-white/60 rounded-xl border border-white/40 p-4">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-base font-semibold text-tamuccBlue">Categories</h2>
            </div>
            <ul class="space-y-2">
              {% if categories %}
              {% for c in categories %}
              <li>
                <a href="/forum?category={{ c.slug }}" class="block text-sm px-3 py-2 rounded-md
                        {% if active_category == c.slug %}
                          bg-tamuccTeal/15 text-tamuccTeal font-medium
                        {% else %}
                          text-gray-700 hover:bg-gray-100/60
                        {% endif %}">
                  {{ c.name }}
                  {% if c.description %}
                  <span class="block text-[11px] text-gray-500 mt-0.5">{{ c.description }}</span>
                  {% endif %}
                </a>
              </li>
              {% endfor %}
              {% else %}
              <li class="text-sm text-gray-500">No categories yet. (default: General)</li>
              {% endif %}
            </ul>
            <a href="/forum/new"
              class="mt-4 w-full inline-flex justify-center items-center gap-1 bg-tamuccBlue text-white py-2 rounded-lg text-sm">
              + New topic
            </a>
          </aside>

          <!-- main discussions -->
          <section class="col-span-12 md:col-span-6 space-y-3">
            <div class="flex items-center justify-between">
              <h2 class="text-base font-semibold text-tamuccBlue">Latest discussions</h2>
              <span class="text-[11px] text-gray-500">
                {% if posts %}{{ posts|length }} active{% else %}No posts yet, be the first ðŸ‘‡{% endif %}
              </span>
            </div>

            <div id="forum-list" class="space-y-3">
              {% for p in posts %}
              <article
                class="bg-white/70 border border-gray-100 rounded-xl px-4 py-3 shadow-sm hover:shadow-md transition"
                data-title="{{ p.title|lower }}" data-tags="{{ (p.tags|join(' ') if p.tags else '')|lower }}">
                <div class="flex items-start justify-between gap-3">
                  <a href="/forum/{{ p._id }}" class="text-sm font-semibold text-tamuccBlue hover:underline">
                    {{ p.title }}
                  </a>
                  {% if p.category_slug %}
                  <span
                    class="inline-flex items-center px-2 py-0.5 rounded-full bg-tamuccTeal/10 text-[11px] text-tamuccTeal">
                    {{ p.category_slug }}
                  </span>
                  {% endif %}
                </div>
                <div class="flex flex-wrap gap-2 mt-2 text-[11px] text-gray-500">
                  <span>{{ p.author_name or "Student" }}</span>
                  {% if p.created_at %}
                  <span>â€¢ {{ p.created_at.strftime('%b %d, %Y %H:%M') }}</span>
                  {% endif %}
                  {% if p.views %}
                  <span>â€¢ {{ p.views }} views</span>
                  {% endif %}
                </div>
                {% if p.tags %}
                <div class="flex gap-2 mt-2 flex-wrap">
                  {% for t in p.tags %}
                  <span class="px-2 py-0.5 bg-gray-100 rounded-full text-[11px] text-gray-700">
                    {{ t }}
                  </span>
                  {% endfor %}
                </div>
                {% endif %}
              </article>
              {% else %}
              <div class="bg-white/60 border border-dashed border-gray-300 rounded-xl py-12 flex flex-col items-center">
                <div class="text-3xl mb-2">ðŸ’¬</div>
                <h3 class="text-sm font-semibold text-tamuccBlue mb-1">No posts yet</h3>
                <p class="text-xs text-gray-500 mb-3">Start the first campus discussion and let others reply.</p>
                <a href="/forum/new" class="bg-tamuccTeal text-white px-4 py-1.5 rounded-lg text-sm">Create a post</a>
              </div>
              {% endfor %}
            </div>
          </section>

          <!-- right rail -->
          <aside class="col-span-12 md:col-span-3 bg-white/60 rounded-xl border border-white/40 p-4 space-y-3">
            <h2 class="text-base font-semibold text-tamuccBlue">Trending / notices</h2>
            <p class="text-[11px] text-gray-500">Show important or auto-suggested threads here.</p>
            <div>
              <h3 class="text-xs font-semibold text-gray-600 mb-2">Quick ideas</h3>
              <ul class="space-y-1 text-sm">
                <li><a class="text-tamuccBlue hover:underline" href="/forum/new?cat=it-support">Report Wi-Fi / LMS
                    issue</a></li>
                <li><a class="text-tamuccBlue hover:underline" href="/forum/new?cat=hostel">Hostel / mess queries</a>
                </li>
                <li><a class="text-tamuccBlue hover:underline" href="/forum/new?cat=general">Lost &amp; found</a></li>
              </ul>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </main>

  <!-- footer -->
  <footer class="bg-[#0f172a] text-white text-center py-4 text-sm mt-6">
    &copy; {{ now().year if now is defined else "2025" }} SmartCampus. All rights reserved.
  </footer>

  <script>
    // simple client-side search
    const search = document.getElementById("forum-search");
    const cards = document.querySelectorAll("#forum-list [data-title]");
    if (search) {
      search.addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase();
        cards.forEach(card => {
          const title = card.dataset.title || "";
          const tags = card.dataset.tags || "";
          card.style.display = (!q || title.includes(q) || tags.includes(q)) ? "block" : "none";
        });
      });
    }
  </script>
</body>

</html>